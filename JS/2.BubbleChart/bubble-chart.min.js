!function(t,e){"function"==typeof define&&define.amd?define(["microplugin"],e):"object"==typeof exports?module.exports=e(require("microplugin")):t.BubbleChart=e(t.MicroPlugin)}(this,function(t){let e=2*Math.PI;return d3.svg.BubbleChart=function(t){let e=this,n=t.size,i=t.size/3,r=t.size/2,o=t.size/10;e.options={},$.extend(e.options,{plugins:[],container:".bubbleChart",viewBoxSize:n,innerRadius:i,outerRadius:r,radiusMin:o,intersectDelta:0,transitDuration:1e3},t),$.extend(e.options,{radiusMax:(e.options.outerRadius-e.options.innerRadius)/2,intersectInc:e.options.intersectDelta},t),e.initializePlugins(e.options.plugins),e.setup(),e.registerClickEvent(e.getNodes()),e.moveToCentral(d3.select(".node"))},$.extend(d3.svg.BubbleChart.prototype,{getTransition:function(){return this.transition},getClickedNode:function(){return this.clickedNode},getCentralNode:function(){return this.centralNode},getOptions:function(){return this.options},randomCirclesPositions:function(t){let n=this,i=[],r=0,o=n.options;for(;i.length<n.items.length&&++r<n.intervalMax;){let r=n.values[i.length],s=Math.max(r*o.radiusMax/n.valueMax,o.radiusMin),a=n.innerRadius+s+Math.random()*(n.outerRadius-n.innerRadius-2*s),c=Math.random()*e,u=n.centralPoint+a*Math.cos(c),l=n.centralPoint+a*Math.sin(c),d=!1;$.each(i,function(e,n){let i=n.cx-u,r=n.cy-l,o=n.r+s;if(i*i+r*r<Math.pow(o-t,2))return d=!0,!1}),d||i.push({cx:u,cy:l,r:s,item:n.items[i.length]})}if(i.length<n.items.length){if(t===o.radiusMin)throw{message:"Not enough space for all bubble. Please change the options.",options:o};return n.randomCirclesPositions(t+o.intersectInc)}return i.shuffle()},getValues:function(){let t=[],e=this;return $.each(e.items,function(n,i){t.push(e.options.data.eval(i))}),t},setup:function(){let t=this,e=t.options,n=$(".bubbleChart").css("height").replace(/[^0-9]/gi,"");t.innerRadius=e.innerRadius,t.outerRadius=e.outerRadius,t.centralPoint=e.size/2,t.intervalMax=e.size*e.size,t.items=e.data.items,t.values=t.getValues(),t.valueMax=t.values.max(),t.svg=d3.select(e.container).append("svg").attr({preserveAspectRatio:"xMidYMid",width:e.size,height:n,class:"bubbleChart"}).attr("viewBox",function(t){return["0 0",e.viewBoxSize,e.viewBoxSize].join(" ")}),t.circlePositions=t.randomCirclesPositions(e.intersectDelta);let i=t.svg.selectAll(".node").data(t.circlePositions).enter().append("g").attr("class",function(t){return["node",e.data.classed(t.item)].join(" ")}),r=d3.scale.category20();i.append("circle").attr({r:function(t){return t.r},cx:function(t){return t.cx},cy:function(t){return t.cy}}).style("fill",function(t){return void 0!==e.data.color?e.data.color(t.item):r(t.item.text)}).attr("opacity","0.8"),i.sort(function(t,n){return e.data.eval(n.item)-e.data.eval(t.item)}),t.transition={},t.event=$.microObserver.get($.misc.uuid()),e.supportResponsive&&($(window).resize(function(){let i=$(e.container).width();t.svg.attr("width",i),t.svg.attr("height",n)}),$(window).resize())},getCirclePositions:function(){return this.circlePositions},moveToCentral:function(t){let e=this,n=d3.svg.transform().translate(function(n){t.select("circle").attr("cx");return[e.centralPoint-n.cx,e.centralPoint-n.cy]});e.centralNode=t,e.transition.centralNode=t.classed({active:!0}).transition().duration(e.options.transitDuration),e.transition.centralNode.attr("transform",n).select("circle").attr("r",function(t){return e.options.innerRadius})},moveToReflection:function(t,e){let n=this,i=d3.svg.transform().translate(function(t){return[2*(n.centralPoint-t.cx),2*(n.centralPoint-t.cy)]});t.transition().duration(n.options.transitDuration).delay(function(t,e){return 10*e}).attr("transform",e?"":i).select("circle").attr("r",function(t){return t.r})},reset:function(t){t.classed({active:!1})},registerClickEvent:function(t){let e=this,n=!1;t.style("cursor","pointer").on("click",function(t){e.clickedNode=d3.select(this),e.event.send("click",e.clickedNode),e.reset(e.centralNode),e.moveToCentral(e.clickedNode),e.moveToReflection(e.svg.selectAll(".node:not(.active)"),n),n=!n})},getNodes:function(){return this.svg.selectAll(".node")},get:function(){return this.svg}}),t.mixin(d3.svg.BubbleChart),d3.svg.BubbleChart});