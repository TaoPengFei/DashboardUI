function initD3(){Array.prototype.min=function(){let e=this[0],t=this.length;for(let n=1;n<t;n++)this[n]<e&&(e=this[n]);return e},Array.prototype.max=function(){let e=this[0],t=this.length;for(let n=1;n<t;n++)this[n]>e&&(e=this[n]);return e},Array.prototype.sum=function(){let e=0;for(let t=0;t<this.length;t++)e+=this[t];return e};let e=function(e){let t;return $.ajax({type:"get",url:e,async:!1,dataType:"json",data:null,success:function(e){t=e}}),t}("/pentaho/plugin/cda/api/doQuery?path=/public/UI/D3/PieChart/pie1.cda&dataAccessId=pie1").resultset,t=["#FF9E16","#0055B8"];new d3pie("pieChart",{header:{title:{text:function(){return e.sort(function(e,t){return t[1]-e[1]})[0][0]}(),color:"#0055B8",fontSize:24,font:"open sans"},subtitle:{text:function(){return(e.map((e,t,n)=>{let o=[];o.push(e[1]);return o[0]}).max()/e.map((e,t,n)=>{let o=[];o.push(e[1]);return o[0]}).sum()*100).toFixed(2)+"%"}(),fontSize:42,font:"TPF_Font_Thin"},titleSubtitlePadding:9,location:"pie-center"},size:{canvasHeight:function(){return console.log($("#pieChart").clientHeight),console.log(document.getElementById("pieChart").clientHeight),console.log(document.getElementById("pieChart").offsetHeight),console.log(document.getElementById("pieChart").scrollHeight),console.log($("#pieChart").width()),console.log($("#pieChart")),500}(),canvasWidth:function(){return $("#pieChart").width()}(),pieInnerRadius:"80%"},data:{sortOrder:"value-desc",content:e.map((e,n,o)=>{let i=[];i.push({label:e[0],value:e[1],color:t[n]});return i[0]})},tooltips:{enabled:!0,type:"placeholder",string:"{label}: {value}",placeholderParser:function(e,t){return t.value=Pie1.addCommas(t.value.toFixed(2)),t.value},styles:{fadeInSpeed:500,backgroundColor:"silver",backgroundOpacity:.8,color:"#ffffcc",borderRadius:4,font:"verdana",fontSize:20,padding:20}},labels:{outer:{pieDistance:32},inner:{hideWhenLessThanPercentage:3},mainLabel:{fontSize:20},percentage:{color:"#ffffff",decimalPlaces:0},value:{color:"#adadad",fontSize:20},lines:{enabled:!0},truncation:{enabled:!0}},effects:{pullOutSegmentOnClick:{effect:"linear",speed:400,size:8}},callbacks:{onClickSegment:function(e){console.log(e.data)}}})}let Pie1={};Pie1.addCommas=(e=>{e+="";x=e.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";let t=/(\d+)(\d{3})/;for(;t.test(x1);)x1=x1.replace(t,"$1,$2");x2=x2.slice(0,3);return x1+x2});